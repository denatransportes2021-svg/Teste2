<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxiControl Pro - Sistema de Gest√£o para Taxistas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d89ef, #1e3c72);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            max-width: 450px;
            margin: 50px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .auth-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ffcc00;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }

        .auth-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #ffcc00, #ffd700);
            color: #000;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .auth-button:hover {
            background: linear-gradient(45deg, #e6b800, #ffcc00);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 204, 0, 0.4);
        }

        .auth-links {
            text-align: center;
            margin-top: 20px;
        }

        .auth-links a {
            color: #ffcc00;
            text-decoration: none;
            margin: 0 10px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .auth-links a:hover {
            color: #ffd700;
            text-decoration: underline;
        }

        .divider {
            margin: 25px 0;
            text-align: center;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        .divider span {
            background: linear-gradient(135deg, #2d89ef, #1e3c72);
            padding: 0 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header .logo {
            font-size: 32px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-welcome {
            font-weight: bold;
            color: #ffcc00;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-button.active {
            background: linear-gradient(45deg, #ffcc00, #ffd700);
            color: #000;
            font-weight: bold;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(5px);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .form-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #ffcc00;
            border-bottom: 2px solid rgba(255, 204, 0, 0.3);
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        input, select, textarea, button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: 2px solid transparent;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ffcc00;
            box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }

        button {
            background: linear-gradient(45deg, #ffcc00, #ffd700);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        button:hover {
            background: linear-gradient(45deg, #e6b800, #ffcc00);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 204, 0, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(45deg, #c82333, #bd2130);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            color: black;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: linear-gradient(45deg, #2d89ef, #1e3c72);
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #e3f2fd;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .hidden {
            display: none;
        }

        .error-message {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }

            .auth-container {
                margin: 20px auto;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="auth-container">
        <div class="logo">üöï</div>
        <div class="auth-title">TaxiControl Pro</div>
        <div class="auth-subtitle">Fa√ßa login para acessar seu painel</div>
        
        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">E-mail</label>
                <input type="email" id="loginEmail" required>
            </div>
            <div class="form-group">
                <label for="loginPassword">Senha</label>
                <input type="password" id="loginPassword" required>
            </div>
            <button type="submit" class="auth-button">Entrar</button>
            <div id="loginError" class="error-message hidden"></div>
        </form>
        
        <div class="auth-links">
            <a href="#" onclick="showRegister()">Criar conta</a>
            <a href="#" onclick="showForgotPassword()">Esqueci minha senha</a>
        </div>
    </div>

    <!-- Tela de Cadastro -->
    <div id="registerScreen" class="auth-container hidden">
        <div class="logo">üöï</div>
        <div class="auth-title">Criar Conta</div>
        <div class="auth-subtitle">Cadastre-se para come√ßar a usar</div>
        
        <form id="registerForm">
            <div class="form-group">
                <label for="registerName">Nome Completo</label>
                <input type="text" id="registerName" required>
            </div>
            <div class="form-group">
                <label for="registerEmail">E-mail</label>
                <input type="email" id="registerEmail" required>
            </div>
            <div class="form-group">
                <label for="registerPhone">Telefone</label>
                <input type="tel" id="registerPhone" placeholder="(11) 99999-9999" required>
            </div>
            <div class="form-group">
                <label for="registerPlaca">Placa do Ve√≠culo</label>
                <input type="text" id="registerPlaca" placeholder="ABC-1234" required>
            </div>
            <div class="form-group">
                <label for="registerPassword">Senha</label>
                <input type="password" id="registerPassword" minlength="6" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirmar Senha</label>
                <input type="password" id="confirmPassword" minlength="6" required>
            </div>
            <button type="submit" class="auth-button">Criar Conta</button>
            <div id="registerError" class="error-message hidden"></div>
        </form>
        
        <div class="auth-links">
            <a href="#" onclick="showLogin()">J√° tenho conta</a>
        </div>
    </div>

    <!-- Tela de Recupera√ß√£o de Senha -->
    <div id="forgotPasswordScreen" class="auth-container hidden">
        <div class="logo">üöï</div>
        <div class="auth-title">Recuperar Senha</div>
        <div class="auth-subtitle">Digite seu e-mail para redefinir a senha</div>
        
        <form id="forgotPasswordForm">
            <div class="form-group">
                <label for="forgotEmail">E-mail</label>
                <input type="email" id="forgotEmail" required>
            </div>
            <button type="submit" class="auth-button">Enviar Link</button>
            <div id="forgotError" class="error-message hidden"></div>
            <div id="forgotSuccess" class="error-message hidden" style="color: #28a745;"></div>
        </form>
        
        <div class="auth-links">
            <a href="#" onclick="showLogin()">Voltar ao login</a>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal -->
    <div id="mainApp" class="hidden">
        <div class="header">
            <div class="logo">üöï TaxiControl Pro</div>
            <div class="subtitle">Sistema Completo de Gest√£o para Taxistas</div>
        </div>

        <div class="container">
            <!-- Informa√ß√µes do Usu√°rio -->
            <div class="user-info">
                <div>
                    <div class="user-welcome">Bem-vindo, <span id="userName"></span>!</div>
                    <div style="font-size: 14px; opacity: 0.8;">Placa: <span id="userPlaca"></span></div>
                </div>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>

            <!-- Estat√≠sticas Principais -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalCorridas">0</div>
                    <div class="stat-label">Corridas Hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="receitaHoje">R$ 0,00</div>
                    <div class="stat-label">Receita Hoje</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="gastosCombustivel">R$ 0,00</div>
                    <div class="stat-label">Gastos Combust√≠vel</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lucroLiquido">R$ 0,00</div>
                    <div class="stat-label">Lucro L√≠quido</div>
                </div>
            </div>

            <!-- Navega√ß√£o por Abas -->
            <div class="nav-tabs">
                <button class="tab-button active" onclick="showTab('corridas')">üìç Corridas</button>
                <button class="tab-button" onclick="showTab('combustivel')">‚õΩ Combust√≠vel</button>
                <button class="tab-button" onclick="showTab('manutencao')">üîß Manuten√ß√£o</button>
                <button class="tab-button" onclick="showTab('relatorios')">üìä Relat√≥rios</button>
            </div>

            <!-- Aba Corridas -->
            <div id="corridas" class="tab-content active">
                <div class="form-section">
                    <div class="form-title">Registrar Nova Corrida</div>
                    <form id="formCorrida">
                        <div class="form-row">
                            <input type="date" id="dataCorrida" required>
                            <input type="text" id="origem" placeholder="Local de origem" required>
                            <input type="text" id="destino" placeholder="Local de destino" required>
                        </div>
                        <div class="form-row">
                            <input type="number" id="valorCorrida" placeholder="Valor da corrida (R$)" step="0.01" required>
                            <select id="formaPagamento" required>
                                <option value="">Forma de pagamento</option>
                                <option value="dinheiro">Dinheiro</option>
                                <option value="cartao">Cart√£o</option>
                                <option value="pix">PIX</option>
                                <option value="app">App (Uber/99)</option>
                                <option value="fiado">Fiado</option>
                            </select>
                        </div>
                        <textarea id="observacoes" placeholder="Observa√ß√µes (opcional)" rows="2"></textarea>
                        <button type="submit">Registrar Corrida</button>
                    </form>
                </div>

                <table id="tabelaCorridas">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Origem ‚Üí Destino</th>
                            <th>Valor</th>
                            <th>Pagamento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Aba Combust√≠vel -->
            <div id="combustivel" class="tab-content">
                <div class="form-section">
                    <div class="form-title">Registrar Abastecimento</div>
                    <form id="formCombustivel">
                        <div class="form-row">
                            <input type="datetime-local" id="dataAbastecimento" required>
                            <input type="number" id="litros" placeholder="Litros" step="0.01" required>
                            <input type="number" id="valorLitro" placeholder="Valor por litro (R$)" step="0.001" required>
                            <input type="text" id="posto" placeholder="Nome do posto" required>
                        </div>
                        <button type="submit">Registrar Abastecimento</button>
                    </form>
                </div>

                <table id="tabelaCombustivel">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Posto</th>
                            <th>Litros</th>
                            <th>Valor/L</th>
                            <th>Total</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Aba Manuten√ß√£o -->
            <div id="manutencao" class="tab-content">
                <div class="form-section">
                    <div class="form-title">Registrar Manuten√ß√£o</div>
                    <form id="formManutencao">
                        <div class="form-row">
                            <input type="date" id="dataManutencao" required>
                            <select id="tipoManutencao" required>
                                <option value="">Tipo de manuten√ß√£o</option>
                                <option value="preventiva">Preventiva</option>
                                <option value="corretiva">Corretiva</option>
                                <option value="revisao">Revis√£o</option>
                                <option value="troca-oleo">Troca de √≥leo</option>
                                <option value="pneus">Pneus</option>
                                <option value="freios">Freios</option>
                                <option value="outros">Outros</option>
                            </select>
                            <input type="number" id="valorManutencao" placeholder="Valor (R$)" step="0.01" required>
                            <input type="text" id="oficina" placeholder="Oficina/Local" required>
                        </div>
                        <textarea id="descricaoManutencao" placeholder="Descri√ß√£o do servi√ßo" rows="2" required></textarea>
                        <button type="submit">Registrar Manuten√ß√£o</button>
                    </form>
                </div>

                <table id="tabelaManutencao">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Oficina</th>
                            <th>Valor</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Aba Relat√≥rios -->
            <div id="relatorios" class="tab-content">
                <div class="form-section">
                    <div class="form-title">Filtros de Relat√≥rio</div>
                    <div class="form-row">
                        <input type="date" id="dataInicio" placeholder="Data in√≠cio">
                        <input type="date" id="dataFim" placeholder="Data fim">
                        <button type="button" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
                    </div>
                </div>

                <div id="relatorioResultado" class="form-section hidden">
                    <div class="form-title">Resumo do Per√≠odo</div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-value" id="relTotalCorridas">0</div>
                            <div class="stat-label">Total de Corridas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="relReceitaTotal">R$ 0,00</div>
                            <div class="stat-label">Receita Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="relGastosTotal">R$ 0,00</div>
                            <div class="stat-label">Gastos Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="relLucroTotal">R$ 0,00</div>
                            <div class="stat-label">Lucro L√≠quido</div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button type="button" onclick="exportarPDF()" style="
                            background: linear-gradient(45deg, #28a745, #20c997);
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 10px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                            üìÑ Exportar PDF
                        </button>
                    </div>
                    
                    <!-- Tabelas detalhadas do relat√≥rio -->
                    <div id="relatorioDetalhado" style="margin-top: 30px;">
                        <div class="form-title">Detalhamento das Corridas</div>
                        <table id="tabelaRelCorridas">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Origem ‚Üí Destino</th>
                                    <th>Valor</th>
                                    <th>Pagamento</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        
                        <div class="form-title" style="margin-top: 30px;">Detalhamento dos Gastos</div>
                        <table id="tabelaRelGastos">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√£o -->
    <div id="notification" class="notification"></div>

    <script>
        // Sistema de autentica√ß√£o e dados
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('taxiUsers')) || [];
        let corridas = [];
        let combustivel = [];
        let manutencao = [];

        // Fun√ß√£o para mostrar notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Fun√ß√µes de navega√ß√£o entre telas
        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('forgotPasswordScreen').classList.add('hidden');
            clearErrors();
        }

        function showRegister() {
            document.getElementById('registerScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('forgotPasswordScreen').classList.add('hidden');
            clearErrors();
        }

        function showForgotPassword() {
            document.getElementById('forgotPasswordScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            clearErrors();
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
        }

        // Formata√ß√£o de telefone
        document.getElementById('registerPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length >= 7) {
                value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length >= 3) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            e.target.value = value;
        });

        // Formata√ß√£o de placa
        document.getElementById('registerPlaca').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
            if (value.length >= 4) {
                value = value.replace(/([A-Z]{3})(\d{1,4})/, '$1-$2');
            }
            e.target.value = value;
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                loadUserData();
                showMainApp();
                showNotification('Login realizado com sucesso!');
            } else {
                document.getElementById('loginError').textContent = 'E-mail ou senha incorretos';
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Cadastro
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const placa = document.getElementById('registerPlaca').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Valida√ß√µes
            if (password !== confirmPassword) {
                document.getElementById('registerError').textContent = 'As senhas n√£o coincidem';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }
            
            if (users.find(u => u.email === email)) {
                document.getElementById('registerError').textContent = 'Este e-mail j√° est√° cadastrado';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }
            
            if (users.find(u => u.placa === placa)) {
                document.getElementById('registerError').textContent = 'Esta placa j√° est√° cadastrada';
                document.getElementById('registerError').classList.remove('hidden');
                return;
            }
            
            // Criar usu√°rio
            const newUser = {
                id: Date.now(),
                name,
                email,
                phone,
                placa,
                password,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('taxiUsers', JSON.stringify(users));
            
            showNotification('Conta criada com sucesso! Fa√ßa login para continuar.');
            showLogin();
        });

        // Recupera√ß√£o de senha
        document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('forgotEmail').value;
            const user = users.find(u => u.email === email);
            
            if (user) {
                // Em um sistema real, enviaria um e-mail
                document.getElementById('forgotSuccess').textContent = 'Link de recupera√ß√£o enviado para seu e-mail!';
                document.getElementById('forgotSuccess').classList.remove('hidden');
                document.getElementById('forgotError').classList.add('hidden');
                
                // Simular reset de senha (em produ√ß√£o seria via link no e-mail)
                setTimeout(() => {
                    const newPassword = 'temp123';
                    user.password = newPassword;
                    localStorage.setItem('taxiUsers', JSON.stringify(users));
                    alert(`Sua nova senha tempor√°ria √©: ${newPassword}\nFa√ßa login e altere sua senha.`);
                    showLogin();
                }, 2000);
            } else {
                document.getElementById('forgotError').textContent = 'E-mail n√£o encontrado';
                document.getElementById('forgotError').classList.remove('hidden');
                document.getElementById('forgotSuccess').classList.add('hidden');
            }
        });

        // Verificar per√≠odo de teste
        function verificarPeriodoTeste() {
            const agora = new Date();
            const criadoEm = new Date(currentUser.createdAt);
            const diasRestantes = 7 - Math.floor((agora - criadoEm) / (1000 * 60 * 60 * 24));
            
            if (diasRestantes <= 0) {
                // Per√≠odo expirado
                mostrarTelaExpiracao();
                return false;
            } else {
                // Mostrar pop-up de boas-vindas com info do teste
                mostrarPopupTeste(diasRestantes);
                return true;
            }
        }

        // Mostrar pop-up de teste gratuito
        function mostrarPopupTeste(diasRestantes) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            popup.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d89ef, #1e3c72);
                    padding: 40px;
                    border-radius: 20px;
                    text-align: center;
                    max-width: 500px;
                    margin: 20px;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                    border: 2px solid #ffcc00;
                ">
                    <div style="font-size: 48px; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #ffcc00; margin-bottom: 20px; font-size: 24px;">
                        Bem-vindo ao TaxiControl Pro!
                    </h2>
                    <p style="color: white; margin-bottom: 20px; font-size: 16px; line-height: 1.5;">
                        Voc√™ est√° no seu <strong>per√≠odo de teste gratuito</strong>!<br>
                        Aproveite todas as funcionalidades por <strong>${diasRestantes} dias restantes</strong>.
                    </p>
                    <div style="background: rgba(255, 204, 0, 0.2); padding: 15px; border-radius: 10px; margin: 20px 0;">
                        <p style="color: #ffcc00; font-weight: bold; margin-bottom: 10px;">
                            ‚ú® Durante o teste voc√™ pode:
                        </p>
                        <ul style="color: white; text-align: left; list-style: none; padding: 0;">
                            <li style="margin: 5px 0;">üìç Registrar corridas ilimitadas</li>
                            <li style="margin: 5px 0;">‚õΩ Controlar gastos com combust√≠vel</li>
                            <li style="margin: 5px 0;">üîß Gerenciar manuten√ß√µes</li>
                            <li style="margin: 5px 0;">üìä Gerar relat√≥rios completos</li>
                        </ul>
                    </div>
                    <button onclick="fecharPopupTeste()" style="
                        background: linear-gradient(45deg, #ffcc00, #ffd700);
                        color: #000;
                        border: none;
                        padding: 15px 30px;
                        border-radius: 10px;
                        font-size: 16px;
                        font-weight: bold;
                        cursor: pointer;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                        transition: all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        Come√ßar a Usar!
                    </button>
                </div>
            `;
            
            document.body.appendChild(popup);
            window.popupTeste = popup;
        }

        // Fechar pop-up de teste
        function fecharPopupTeste() {
            if (window.popupTeste) {
                document.body.removeChild(window.popupTeste);
                window.popupTeste = null;
            }
        }

        // Mostrar tela de expira√ß√£o
        function mostrarTelaExpiracao() {
            document.getElementById('mainApp').innerHTML = `
                <div style="
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    min-height: 80vh;
                    text-align: center;
                    padding: 40px;
                ">
                    <div style="
                        background: rgba(255, 255, 255, 0.1);
                        padding: 50px;
                        border-radius: 20px;
                        backdrop-filter: blur(15px);
                        max-width: 600px;
                        border: 2px solid #ffcc00;
                    ">
                        <div style="font-size: 64px; margin-bottom: 20px;">‚è∞</div>
                        <h2 style="color: #ffcc00; margin-bottom: 20px; font-size: 28px;">
                            Per√≠odo de Teste Expirado
                        </h2>
                        <p style="color: white; margin-bottom: 30px; font-size: 18px; line-height: 1.6;">
                            Seu teste gratuito de 7 dias chegou ao fim!<br>
                            Esperamos que tenha gostado do <strong>TaxiControl Pro</strong>.
                        </p>
                        <div style="background: rgba(255, 204, 0, 0.2); padding: 20px; border-radius: 10px; margin: 30px 0;">
                            <p style="color: #ffcc00; font-weight: bold; margin-bottom: 15px; font-size: 20px;">
                                üöÄ Continue aproveitando!
                            </p>
                            <p style="color: white; margin-bottom: 15px;">
                                Para continuar usando todas as funcionalidades,<br>
                                entre em contato conosco:
                            </p>
                            <div style="color: #ffcc00; font-weight: bold;">
                                üìß contato@taxicontrolpro.com<br>
                                üì± (11) 99999-9999
                            </div>
                        </div>
                        <button onclick="logout()" style="
                            background: linear-gradient(45deg, #ffcc00, #ffd700);
                            color: #000;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 10px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            margin-right: 15px;
                        ">
                            Fazer Logout
                        </button>
                        <button onclick="criarNovaConta()" style="
                            background: rgba(255, 255, 255, 0.2);
                            color: white;
                            border: 2px solid #ffcc00;
                            padding: 15px 30px;
                            border-radius: 10px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                        ">
                            Nova Conta
                        </button>
                    </div>
                </div>
            `;
        }

        // Criar nova conta (redireciona para cadastro)
        function criarNovaConta() {
            logout();
            setTimeout(() => showRegister(), 500);
        }

        // Mostrar aplica√ß√£o principal
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('forgotPasswordScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userPlaca').textContent = currentUser.placa;
            
            // Verificar per√≠odo de teste
            if (!verificarPeriodoTeste()) {
                return; // Se expirado, n√£o continua
            }
        }

        // Logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                // Fechar pop-up se estiver aberto
                if (window.popupTeste) {
                    fecharPopupTeste();
                }
                
                currentUser = null;
                localStorage.removeItem('currentUser');
                
                // Limpar dados tempor√°rios
                corridas = [];
                combustivel = [];
                manutencao = [];
                
                // Resetar interface completamente
                document.getElementById('mainApp').classList.add('hidden');
                showLogin();
                showNotification('Logout realizado com sucesso!');
                
                // Limpar formul√°rios
                document.querySelectorAll('form').forEach(form => form.reset());
                
                // Resetar estat√≠sticas
                document.getElementById('totalCorridas').textContent = '0';
                document.getElementById('receitaHoje').textContent = 'R$ 0,00';
                document.getElementById('gastosCombustivel').textContent = 'R$ 0,00';
                document.getElementById('lucroLiquido').textContent = 'R$ 0,00';
                
                // Limpar tabelas
                document.querySelectorAll('tbody').forEach(tbody => tbody.innerHTML = '');
            }
        }

        // Carregar dados do usu√°rio
        function loadUserData() {
            const userKey = `user_${currentUser.id}`;
            corridas = JSON.parse(localStorage.getItem(`${userKey}_corridas`)) || [];
            combustivel = JSON.parse(localStorage.getItem(`${userKey}_combustivel`)) || [];
            manutencao = JSON.parse(localStorage.getItem(`${userKey}_manutencao`)) || [];
        }

        // Salvar dados do usu√°rio
        function saveUserData() {
            if (!currentUser) return;
            const userKey = `user_${currentUser.id}`;
            localStorage.setItem(`${userKey}_corridas`, JSON.stringify(corridas));
            localStorage.setItem(`${userKey}_combustivel`, JSON.stringify(combustivel));
            localStorage.setItem(`${userKey}_manutencao`, JSON.stringify(manutencao));
        }

        // Fun√ß√£o para alternar abas
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Registrar corrida
        document.getElementById('formCorrida').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const corrida = {
                id: Date.now(),
                data: document.getElementById('dataCorrida').value,
                origem: document.getElementById('origem').value,
                destino: document.getElementById('destino').value,
                valor: parseFloat(document.getElementById('valorCorrida').value),
                formaPagamento: document.getElementById('formaPagamento').value,
                observacoes: document.getElementById('observacoes').value
            };
            
            corridas.push(corrida);
            saveUserData();
            
            this.reset();
            // Definir data atual ap√≥s reset
            document.getElementById('dataCorrida').value = new Date().toISOString().split('T')[0];
            atualizarTabelaCorridas();
            atualizarEstatisticas();
            showNotification('Corrida registrada com sucesso!');
        });

        // Registrar combust√≠vel
        document.getElementById('formCombustivel').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const abastecimento = {
                id: Date.now(),
                data: document.getElementById('dataAbastecimento').value,
                litros: parseFloat(document.getElementById('litros').value),
                valorLitro: parseFloat(document.getElementById('valorLitro').value),
                posto: document.getElementById('posto').value
            };
            
            abastecimento.total = abastecimento.litros * abastecimento.valorLitro;
            
            combustivel.push(abastecimento);
            saveUserData();
            
            this.reset();
            atualizarTabelaCombustivel();
            atualizarEstatisticas();
            showNotification('Abastecimento registrado com sucesso!');
        });

        // Registrar manuten√ß√£o
        document.getElementById('formManutencao').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const manut = {
                id: Date.now(),
                data: document.getElementById('dataManutencao').value,
                tipo: document.getElementById('tipoManutencao').value,
                valor: parseFloat(document.getElementById('valorManutencao').value),
                oficina: document.getElementById('oficina').value,
                descricao: document.getElementById('descricaoManutencao').value
            };
            
            manutencao.push(manut);
            saveUserData();
            
            this.reset();
            atualizarTabelaManutencao();
            atualizarEstatisticas();
            showNotification('Manuten√ß√£o registrada com sucesso!');
        });

        // Atualizar tabela de corridas
        function atualizarTabelaCorridas() {
            const tbody = document.querySelector('#tabelaCorridas tbody');
            tbody.innerHTML = '';
            
            corridas.forEach(corrida => {
                const row = tbody.insertRow();
                const dataFormatada = new Date(corrida.data).toLocaleDateString('pt-BR');
                row.innerHTML = `
                    <td>${dataFormatada}</td>
                    <td>${corrida.origem} ‚Üí ${corrida.destino}</td>
                    <td>R$ ${corrida.valor.toFixed(2)}</td>
                    <td>${corrida.formaPagamento}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-danger" onclick="excluirCorrida(${corrida.id})">Excluir</button>
                        </div>
                    </td>
                `;
            });
        }

        // Atualizar tabela de combust√≠vel
        function atualizarTabelaCombustivel() {
            const tbody = document.querySelector('#tabelaCombustivel tbody');
            tbody.innerHTML = '';
            
            combustivel.forEach(item => {
                const row = tbody.insertRow();
                const data = new Date(item.data).toLocaleString('pt-BR');
                row.innerHTML = `
                    <td>${data}</td>
                    <td>${item.posto}</td>
                    <td>${item.litros.toFixed(2)}L</td>
                    <td>R$ ${item.valorLitro.toFixed(3)}</td>
                    <td>R$ ${item.total.toFixed(2)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-danger" onclick="excluirCombustivel(${item.id})">Excluir</button>
                        </div>
                    </td>
                `;
            });
        }

        // Atualizar tabela de manuten√ß√£o
        function atualizarTabelaManutencao() {
            const tbody = document.querySelector('#tabelaManutencao tbody');
            tbody.innerHTML = '';
            
            manutencao.forEach(item => {
                const row = tbody.insertRow();
                const data = new Date(item.data).toLocaleDateString('pt-BR');
                row.innerHTML = `
                    <td>${data}</td>
                    <td>${item.tipo}</td>
                    <td>${item.descricao}</td>
                    <td>${item.oficina}</td>
                    <td>R$ ${item.valor.toFixed(2)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-small btn-danger" onclick="excluirManutencao(${item.id})">Excluir</button>
                        </div>
                    </td>
                `;
            });
        }

        // Fun√ß√µes de exclus√£o
        function excluirCorrida(id) {
            if (confirm('Tem certeza que deseja excluir esta corrida?')) {
                corridas = corridas.filter(c => c.id !== id);
                saveUserData();
                atualizarTabelaCorridas();
                atualizarEstatisticas();
                showNotification('Corrida exclu√≠da com sucesso!');
            }
        }

        function excluirCombustivel(id) {
            if (confirm('Tem certeza que deseja excluir este abastecimento?')) {
                combustivel = combustivel.filter(c => c.id !== id);
                saveUserData();
                atualizarTabelaCombustivel();
                atualizarEstatisticas();
                showNotification('Abastecimento exclu√≠do com sucesso!');
            }
        }

        function excluirManutencao(id) {
            if (confirm('Tem certeza que deseja excluir esta manuten√ß√£o?')) {
                manutencao = manutencao.filter(m => m.id !== id);
                saveUserData();
                atualizarTabelaManutencao();
                atualizarEstatisticas();
                showNotification('Manuten√ß√£o exclu√≠da com sucesso!');
            }
        }

        // Atualizar estat√≠sticas
        function atualizarEstatisticas() {
            const hoje = new Date().toISOString().split('T')[0];
            
            const corridasHoje = corridas.filter(c => c.data === hoje);
            const totalCorridas = corridasHoje.length;
            const receitaHoje = corridasHoje.reduce((sum, c) => sum + c.valor, 0);
            
            const dataLimite = new Date();
            dataLimite.setDate(dataLimite.getDate() - 30);
            const gastosCombustivel = combustivel
                .filter(c => new Date(c.data) >= dataLimite)
                .reduce((sum, c) => sum + c.total, 0);
            
            const lucroLiquido = receitaHoje - (gastosCombustivel / 30);
            
            document.getElementById('totalCorridas').textContent = totalCorridas;
            document.getElementById('receitaHoje').textContent = `R$ ${receitaHoje.toFixed(2)}`;
            document.getElementById('gastosCombustivel').textContent = `R$ ${gastosCombustivel.toFixed(2)}`;
            document.getElementById('lucroLiquido').textContent = `R$ ${lucroLiquido.toFixed(2)}`;
        }

        // Vari√°veis globais para o relat√≥rio
        let dadosRelatorio = {};

        // Gerar relat√≥rio
        function gerarRelatorio() {
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;
            
            if (!dataInicio || !dataFim) {
                showNotification('Selecione as datas de in√≠cio e fim', 'error');
                return;
            }
            
            const corridasPeriodo = corridas.filter(c => c.data >= dataInicio && c.data <= dataFim);
            const combustivelPeriodo = combustivel.filter(c => c.data.split('T')[0] >= dataInicio && c.data.split('T')[0] <= dataFim);
            const manutencaoPeriodo = manutencao.filter(m => m.data >= dataInicio && m.data <= dataFim);
            
            const totalCorridas = corridasPeriodo.length;
            const receitaTotal = corridasPeriodo.reduce((sum, c) => sum + c.valor, 0);
            const gastosCombustivel = combustivelPeriodo.reduce((sum, c) => sum + c.total, 0);
            const gastosManutencao = manutencaoPeriodo.reduce((sum, m) => sum + m.valor, 0);
            const gastosTotal = gastosCombustivel + gastosManutencao;
            const lucroTotal = receitaTotal - gastosTotal;
            
            // Salvar dados para exporta√ß√£o
            dadosRelatorio = {
                dataInicio,
                dataFim,
                corridasPeriodo,
                combustivelPeriodo,
                manutencaoPeriodo,
                totalCorridas,
                receitaTotal,
                gastosCombustivel,
                gastosManutencao,
                gastosTotal,
                lucroTotal
            };
            
            document.getElementById('relTotalCorridas').textContent = totalCorridas;
            document.getElementById('relReceitaTotal').textContent = `R$ ${receitaTotal.toFixed(2)}`;
            document.getElementById('relGastosTotal').textContent = `R$ ${gastosTotal.toFixed(2)}`;
            document.getElementById('relLucroTotal').textContent = `R$ ${lucroTotal.toFixed(2)}`;
            
            // Preencher tabelas detalhadas
            preencherTabelasRelatorio();
            
            document.getElementById('relatorioResultado').classList.remove('hidden');
            showNotification('Relat√≥rio gerado com sucesso!');
        }

        // Preencher tabelas do relat√≥rio
        function preencherTabelasRelatorio() {
            // Tabela de corridas
            const tbodyCorridas = document.querySelector('#tabelaRelCorridas tbody');
            tbodyCorridas.innerHTML = '';
            
            dadosRelatorio.corridasPeriodo.forEach(corrida => {
                const row = tbodyCorridas.insertRow();
                const dataFormatada = new Date(corrida.data).toLocaleDateString('pt-BR');
                row.innerHTML = `
                    <td>${dataFormatada}</td>
                    <td>${corrida.origem} ‚Üí ${corrida.destino}</td>
                    <td>R$ ${corrida.valor.toFixed(2)}</td>
                    <td>${corrida.formaPagamento}</td>
                `;
            });
            
            // Tabela de gastos
            const tbodyGastos = document.querySelector('#tabelaRelGastos tbody');
            tbodyGastos.innerHTML = '';
            
            // Adicionar combust√≠vel
            dadosRelatorio.combustivelPeriodo.forEach(item => {
                const row = tbodyGastos.insertRow();
                const data = new Date(item.data).toLocaleDateString('pt-BR');
                row.innerHTML = `
                    <td>${data}</td>
                    <td>Combust√≠vel</td>
                    <td>${item.posto} - ${item.litros.toFixed(2)}L</td>
                    <td>R$ ${item.total.toFixed(2)}</td>
                `;
            });
            
            // Adicionar manuten√ß√£o
            dadosRelatorio.manutencaoPeriodo.forEach(item => {
                const row = tbodyGastos.insertRow();
                const data = new Date(item.data).toLocaleDateString('pt-BR');
                row.innerHTML = `
                    <td>${data}</td>
                    <td>Manuten√ß√£o</td>
                    <td>${item.descricao} - ${item.oficina}</td>
                    <td>R$ ${item.valor.toFixed(2)}</td>
                `;
            });
        }

        // Exportar para PDF
        function exportarPDF() {
            if (!dadosRelatorio.dataInicio) {
                showNotification('Gere um relat√≥rio primeiro!', 'error');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configura√ß√µes
                const pageWidth = doc.internal.pageSize.width;
                const margin = 20;
                let yPosition = 30;
                
                // Cabe√ßalho
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('üöï TaxiControl Pro', margin, yPosition);
                
                yPosition += 10;
                doc.setFontSize(16);
                doc.text('Relat√≥rio de Atividades', margin, yPosition);
                
                yPosition += 15;
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                
                // Informa√ß√µes do usu√°rio
                doc.text(`Taxista: ${currentUser.name}`, margin, yPosition);
                yPosition += 7;
                doc.text(`Placa: ${currentUser.placa}`, margin, yPosition);
                yPosition += 7;
                
                // Per√≠odo
                const dataInicioFormatada = new Date(dadosRelatorio.dataInicio).toLocaleDateString('pt-BR');
                const dataFimFormatada = new Date(dadosRelatorio.dataFim).toLocaleDateString('pt-BR');
                doc.text(`Per√≠odo: ${dataInicioFormatada} a ${dataFimFormatada}`, margin, yPosition);
                yPosition += 7;
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, margin, yPosition);
                
                yPosition += 20;
                
                // Resumo financeiro
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('RESUMO FINANCEIRO', margin, yPosition);
                yPosition += 15;
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                
                // Criar tabela de resumo
                const resumoData = [
                    ['Total de Corridas', dadosRelatorio.totalCorridas.toString()],
                    ['Receita Total', `R$ ${dadosRelatorio.receitaTotal.toFixed(2)}`],
                    ['Gastos com Combust√≠vel', `R$ ${dadosRelatorio.gastosCombustivel.toFixed(2)}`],
                    ['Gastos com Manuten√ß√£o', `R$ ${dadosRelatorio.gastosManutencao.toFixed(2)}`],
                    ['Total de Gastos', `R$ ${dadosRelatorio.gastosTotal.toFixed(2)}`],
                    ['LUCRO L√çQUIDO', `R$ ${dadosRelatorio.lucroTotal.toFixed(2)}`]
                ];
                
                resumoData.forEach((row, index) => {
                    if (index === resumoData.length - 1) {
                        doc.setFont(undefined, 'bold');
                    }
                    doc.text(row[0] + ':', margin, yPosition);
                    doc.text(row[1], margin + 100, yPosition);
                    yPosition += 8;
                });
                
                // Nova p√°gina para detalhes
                doc.addPage();
                yPosition = 30;
                
                // Detalhamento das corridas
                if (dadosRelatorio.corridasPeriodo.length > 0) {
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('DETALHAMENTO DAS CORRIDAS', margin, yPosition);
                    yPosition += 15;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    dadosRelatorio.corridasPeriodo.forEach((corrida, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 30;
                        }
                        
                        const data = new Date(corrida.data).toLocaleDateString('pt-BR');
                        doc.text(`${index + 1}. ${data}`, margin, yPosition);
                        yPosition += 5;
                        doc.text(`   ${corrida.origem} ‚Üí ${corrida.destino}`, margin, yPosition);
                        yPosition += 5;
                        doc.text(`   Valor: R$ ${corrida.valor.toFixed(2)} | Pagamento: ${corrida.formaPagamento}`, margin, yPosition);
                        if (corrida.observacoes) {
                            yPosition += 5;
                            doc.text(`   Obs: ${corrida.observacoes}`, margin, yPosition);
                        }
                        yPosition += 10;
                    });
                }
                
                // Detalhamento dos gastos
                const todosGastos = [
                    ...dadosRelatorio.combustivelPeriodo.map(item => ({
                        data: item.data,
                        tipo: 'Combust√≠vel',
                        descricao: `${item.posto} - ${item.litros.toFixed(2)}L`,
                        valor: item.total
                    })),
                    ...dadosRelatorio.manutencaoPeriodo.map(item => ({
                        data: item.data,
                        tipo: 'Manuten√ß√£o',
                        descricao: `${item.descricao} - ${item.oficina}`,
                        valor: item.valor
                    }))
                ];
                
                if (todosGastos.length > 0) {
                    if (yPosition > 200) {
                        doc.addPage();
                        yPosition = 30;
                    }
                    
                    yPosition += 10;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('DETALHAMENTO DOS GASTOS', margin, yPosition);
                    yPosition += 15;
                    
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'normal');
                    
                    todosGastos.forEach((gasto, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 30;
                        }
                        
                        const data = new Date(gasto.data).toLocaleDateString('pt-BR');
                        doc.text(`${index + 1}. ${data} - ${gasto.tipo}`, margin, yPosition);
                        yPosition += 5;
                        doc.text(`   ${gasto.descricao}`, margin, yPosition);
                        yPosition += 5;
                        doc.text(`   Valor: R$ ${gasto.valor.toFixed(2)}`, margin, yPosition);
                        yPosition += 10;
                    });
                }
                
                // Salvar o PDF
                const nomeArquivo = `TaxiControl_Relatorio_${dataInicioFormatada.replace(/\//g, '-')}_a_${dataFimFormatada.replace(/\//g, '-')}.pdf`;
                doc.save(nomeArquivo);
                
                showNotification('PDF exportado com sucesso!');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF. Tente novamente.', 'error');
            }
        }

        // Inicializar aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se h√° usu√°rio logado
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                loadUserData();
                showMainApp();
                atualizarTabelaCorridas();
                atualizarTabelaCombustivel();
                atualizarTabelaManutencao();
                atualizarEstatisticas();
                
                // Definir data atual no campo de corrida
                document.getElementById('dataCorrida').value = new Date().toISOString().split('T')[0];
            } else {
                showLogin();
            }
            
            // Definir data atual nos campos de relat√≥rio
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataInicio').value = hoje;
            document.getElementById('dataFim').value = hoje;
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96fb0640a65ef1f6',t:'MTc1NTI4NTM2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
